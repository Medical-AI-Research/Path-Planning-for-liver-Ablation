# Path-Planning-for-liver-Ablation
Automated path planning framework for liver tumor ablation using CT/MRI and tumor segmentation. Generates, filters, and ranks safe needle insertion trajectories based on geometric and clinical constraints to support accurate image-guided liver ablation.
Overview

This repository implements an automated optimisation-based needle path planning framework for liver tumor ablation using medical imaging data. The system analyzes CT imaging, tumor segmentation, and anatomical structures to generate, evaluate, and rank safe and clinically feasible needle insertion paths for image-guided percutaneous liver ablation procedures.

The framework focuses on collision avoidance, clinical constraints, and interpretability, making it suitable for research, prototyping, and potential integration into clinical navigation systems.

Problem Statement

Percutaneous liver ablation requires accurate needle placement to ensure complete tumor coverage while avoiding critical organs. Manual planning is time-consuming and highly dependent on operator expertise. This project addresses the need for an automated, objective, and reproducible needle path planning system that improves safety and consistency.

Workflow
1. DICOM Input

Patient-specific CT DICOM images are used as the anatomical reference for planning feasible needle paths.

2. Anatomical Segmentation

CT images are processed using MOOSEz to automatically segment organs and surrounding anatomy. These structures are used for collision detection and safety evaluation.

3. Tumour Mask Input

A pre-segmented tumour mask in NIfTI (.nii) format is provided as input, representing the target lesion for ablation.

4. Tumour Analysis

From the tumour mask, the system computes:

Tumour volume (voxel-based)

Tumour voxel coordinates

Tumour centroid (used as the target point)

5. Optimisation-Based Path Sampling

Multiple candidate needle paths are generated by sampling direction vectors around the tumor centroid. Each direction is extended to the skin surface to form straight-line candidate paths.

6. Collision Checking

Each candidate path is checked against segmented anatomy to detect intersections with organs or restricted regions.

7. Feasible Path Selection

Only collision-free paths that satisfy hard clinical constraints (needle length, insertion angle) are retained.

8. Path Ranking

Feasible paths are ranked using geometric criteria such as:

Path length

Insertion angle
Lower-cost paths are prioritised as better clinical candidates.

9. Needle Recommendation

Based on tumour volume and ranked paths, the system recommends the most suitable ablation needle for the procedure.

Future Enhancements

Multi-objective cost function (length, angle, safety)

Adaptive two-stage sampling

Soft and hard constraint separation

Product operability preference 

Digestive organ segmentation as hard constraints

Safety margin for motion, uncertainty, and registration errors

Output:

<img width="882" height="845" alt="Screenshot 2025-12-23 162341" src="https://github.com/user-attachments/assets/5c04329a-7aca-44c4-8f8a-86ac75a4cd3d" />

<img width="1069" height="624" alt="Screenshot 2025-12-21 173237" src="https://github.com/user-attachments/assets/910afdca-6ae5-4db4-92e0-86a3e30ee4e8" />

<img width="822" height="634" alt="Screenshot 2025-12-21 172308" src="https://github.com/user-attachments/assets/e4276613-f3f9-461b-a054-e33eb2139e5a" />

<img width="886" height="828" alt="Screenshot 2025-12-23 162000" src="https://github.com/user-attachments/assets/0060fa2f-aca0-4c3c-a422-b9c60809accc" />




